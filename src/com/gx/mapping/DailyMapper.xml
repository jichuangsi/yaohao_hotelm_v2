<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gx.dao.DailyconsumptionDao">
    <resultMap id="BaseResultMap" type="com.gx.po.DailyconsumptionPo">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Oct 16 19:18:30 CST 2016.
        -->
        <constructor>
            <idArg column="id" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="supplierId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="roomId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="roomNumber" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="money" jdbcType="DOUBLE" javaType="java.lang.Double"/>
            <arg column="time" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="cid" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="content" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="createTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp" />
        </constructor>
    </resultMap>

    <!--   新增 -->
    <insert id="insertAll" parameterType="com.gx.po.DailyconsumptionPo" useGeneratedKeys="true"  keyProperty="id">
     INSERT INTO `dailyconsumption` (supplierId,roomId,roomNumber,money,`time`,cid,content,createTime)
     values (#{supplierId,jdbcType=INTEGER}, #{roomId,jdbcType=INTEGER},
             #{roomNumber,jdbcType=VARCHAR}, #{money,jdbcType=DOUBLE}
             , #{time,jdbcType=VARCHAR}, #{cid,jdbcType=INTEGER}
              , #{content,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP})
  </insert>

    <!--   修改要用的精确查询 -->
    <select id="selectById" resultType="com.gx.po.DailyconsumptionPo" parameterType="java.lang.Integer">
   SELECT *,c.name AS typeName FROM `dailyconsumption` d INNER JOIN`consumptiontype` c ON d.cid=c.id
    where d.id=#{id,jdbcType=INTEGER}
   </select>

    <!--   修改要用的精确查询 -->
    <select id="selectByTimeAndRoom" resultType="com.gx.po.DailyconsumptionPo">
    select * from `dailyconsumption`
    where roomId=#{roomId,jdbcType=INTEGER}
        AND `time`=#{time,jdbcType=VARCHAR}
        AND cid=#{cid,jdbcType=INTEGER}
   </select>

<update id="updateTimeRoom" parameterType="com.gx.po.DailyconsumptionPo">
        UPDATE `dailyconsumption`
        SET
          `money` =#{money,jdbcType=DOUBLE},
          content=#{content,jdbcType=VARCHAR}
        WHERE `id` =#{cid,jdbcType=INTEGER}
</update>
    <update id="updateAll" parameterType="com.gx.po.DailyconsumptionPo">
        UPDATE `dailyconsumption`
        SET
          `roomId` =#{roomId,jdbcType=INTEGER},
          `roomNumber` =#{roomNumber,jdbcType=INTEGER},
          `cid` = #{cid,jdbcType=INTEGER},
          `money` =#{money,jdbcType=DOUBLE},
          content=#{content,jdbcType=VARCHAR}
        WHERE `id` =#{cid,jdbcType=INTEGER}
</update>
    <!--根据类型，酒店、房号、查询、月份消费-->
    <select id="selectSumMoney" resultType="java.lang.Double">
    SELECT SUM(`money`)
    FROM `dailyconsumption`
    WHERE  DATE_FORMAT(`time`, '%Y-%m')=DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m')
    AND `cid`=#{cid,jdbcType=INTEGER}  AND `roomId`=#{roomId,jdbcType=INTEGER}
     AND `supplierId`=#{supplierId,jdbcType=INTEGER}
  </select>

    <select id="list"  resultType="com.gx.po.DailyconsumptionPo">
        SELECT d.*,c.`name`,s.`supplierName`
        FROM `dailyconsumption` d INNER JOIN `consumptiontype` c ON d.`cid`=c.`id`
        INNER JOIN `supplier` s ON s.id=d.`supplierId`
    </select>

    <select id="updateNumberByRoomId" resultType="java.lang.Integer">
      UPDATE `dailyconsumption` SET `roomNumber`=#{roomNumber,jdbcType=VARCHAR} WHERE `roomId`=#{roomId,jdbcType=INTEGER}
    </select>

    <select id="listPage"  resultType="com.gx.po.DailyconsumptionPo">
        SELECT  d.*,c.`name`,s.`supplierName`
          FROM `dailyconsumption` d INNER JOIN `consumptiontype` c
          ON d.cid=c.id INNER JOIN `supplier` s ON s.id=d.`supplierId`
          WHERE 1=1
          <if test="time!=null and time!=''">
            AND  DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m')=DATE_FORMAT(`time`, '%Y-%m')
          </if>
        ORDER BY `createTime` DESC
        LIMIT #{start},#{pageSize}
    </select>

    <select id="countpage"  resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `dailyconsumption` d INNER JOIN `consumptiontype` c
        ON d.cid=c.id INNER JOIN `supplier` s ON s.id=d.`supplierId`
        WHERE 1=1
        <if test="time!=null and time!=''">
            AND  DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m')=DATE_FORMAT(`time`, '%Y-%m')
        </if>
    </select>

    <select id="financesum"  resultType="com.gx.po.DailyconsumptionPo">
       SELECT *, SUM(`money`) mm FROM `dailyconsumption`
       WHERE  DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m')=DATE_FORMAT(`time`, '%Y-%m')
       AND `roomId`=#{roomId,jdbcType=INTEGER} AND cid=#{cid,jdbcType=INTEGER}
    </select>

    <select id="dailydateil"  resultType="com.gx.po.DailyconsumptionPo">
      SELECT *,cp.name AS typeName FROM `dailyconsumption` d INNER JOIN `consumptiontype` cp ON d.cid=cp.id
       WHERE  `roomId`=#{roomId,jdbcType=INTEGER} AND cid=#{cid,jdbcType=INTEGER}
       AND  DATE_FORMAT(`time`, '%Y-%m')=#{time,jdbcType=VARCHAR}
       ORDER BY `time`
    </select>

    <delete id="delById">
         DELETE FROM `dailyconsumption` WHERE id=#{id,jdbcType=INTEGER}
    </delete>
</mapper>