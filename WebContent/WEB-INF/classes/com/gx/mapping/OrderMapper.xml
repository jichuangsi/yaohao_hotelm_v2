<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gx.dao.OrderDao">
    <resultMap id="BaseResultMap" type="com.gx.po.OrderPo">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Oct 16 19:18:30 CST 2016.
        -->
        <constructor>
            <idArg column="id" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="orderNumber" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="status" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="platformId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="money" jdbcType="DOUBLE" javaType="java.lang.Double"/>
            <arg column="currency" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="hotelmId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="roomId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="checkinTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
            <arg column="checkoutTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
            <arg column="orderTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
            <arg column="passengerId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="isdao" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="daoTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
            <arg column="checkinNumber" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="checkinRoom" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="account" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="checkinDay" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="type" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="in" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="out" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="hometype" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        </constructor>
    </resultMap>

    <!--  //新增订单-->
    <insert id="inserAll" parameterType="com.gx.po.OrderPo" useGeneratedKeys="true" keyProperty="id">
     INSERT INTO `order` (orderNumber,status,platformId,money,currency,hotelmId,roomId,checkinTime,checkoutTime,orderTime,
     passengerId,isdao,daoTime,checkinNumber,checkinRoom,account,checkinDay,`type`,hometype,deposit,depositSattus)
     values (#{orderNumber,jdbcType=VARCHAR},#{status,jdbcType=INTEGER}
     ,#{platformId,jdbcType=INTEGER},#{money,jdbcType=DOUBLE}
     ,#{currency,jdbcType=INTEGER},#{hotelmId,jdbcType=INTEGER},#{roomId,jdbcType=INTEGER},#{checkinTime,jdbcType=TIMESTAMP}
     ,#{checkoutTime,jdbcType=TIMESTAMP},#{orderTime,jdbcType=TIMESTAMP},#{passengerId,jdbcType=INTEGER},#{isdao,jdbcType=INTEGER}
     ,#{daoTime,jdbcType=TIMESTAMP},#{checkinNumber,jdbcType=INTEGER},#{checkinRoom,jdbcType=INTEGER},#{account,jdbcType=INTEGER},#{checkinDay,jdbcType=INTEGER},
    #{type,jdbcType=INTEGER} ,#{hometype,jdbcType=INTEGER},#{deposit,jdbcType=DOUBLE}
     ,#{depositSattus,jdbcType=INTEGER})
  </insert>
    <!--已确认-->
    <select id="list" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=2
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countList" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND */o.status=2
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!--已入住-->
    <select id="checkinorder" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND*/ o.status=5
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countcheckinorder" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND*/ o.status=5
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!--已退房-->
    <select id="checkoutorder" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        /*WHERE `type`=1*/
        WHERE /*`type`=1 AND*/ o.status=6
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY `checkinTime` DESC
        LIMIT #{start},#{size}
    </select>

    <select id="countcheckoutorder" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND*/ o.status=6
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!--已到账-->
    <select id="myaccount" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        /*WHERE `type`=1*/
        WHERE /*`type`=1 AND*/ o.isdao=2
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY `checkinTime` DESC
        LIMIT #{start},#{size}
    </select>

    <select id="countmyaccount" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND*/ o.isdao=2
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!-- 入住情况-->
    <select id="selectRoomByTime" resultType="com.gx.vo.OrderTimeVo">
    SELECT o.id AS orderId, o.`checkinNumber`,r.`roomAmount`,r.`roomAmount`-o.`checkinNumber` AS remainingBeds,
    r.`roomNumber`,s.`supplierName`,r.`id` AS roomId
    FROM `room` r LEFT JOIN `order` o ON o.`roomId`=r.id
    INNER JOIN `supplier` s ON s.id=r.`supplierID`
    WHERE s.`have`=1  AND o.`status`!=6 AND o.`status`!=3
   AND  DATE_FORMAT(#{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') >= DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
    AND DATE_FORMAT(#{time,jdbcType=TIMESTAMP}, '%Y-%m-%d')&lt; DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
      LIMIT #{start},#{size}
  </select>

    <select id="selectRoom" resultType="com.gx.vo.OrderTimeVo">
     SELECT *,id AS roomId  FROM `room`
  </select>

    <select id="selectRoomPage" resultType="com.gx.vo.OrderTimeVo">
      SELECT *,r.id AS roomId  FROM `room` r INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
    WHERE g.`status`=1
      LIMIT #{start},#{size}
  </select>
    <select id="countSelectRoom" resultType="java.lang.Integer">
     SELECT COUNT(*) FROM `room` r INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
    WHERE g.`status`=1
  </select>
    <!-- 入住情况-->
    <select id="selectRoomByTimes" resultType="com.gx.vo.OrderTimeVo">
        SELECT o.id AS orderId, o.`checkinNumber`,r.`roomAmount`,r.`roomAmount`-o.`checkinNumber` AS remainingBeds,
        r.`roomNumber`,s.`supplierName`,r.`id` AS roomId,s.id AS supplierId
        FROM `room` r LEFT JOIN `order` o ON o.`roomId`=r.id
        INNER JOIN `supplier` s ON s.id=r.`supplierID`
        INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
        WHERE s.`have`=1 AND o.`status`!=6 AND o.`status`!=3 AND g.`status`=1
        AND DATE_FORMAT(#{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') >= DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
        AND DATE_FORMAT(#{time,jdbcType=TIMESTAMP}, '%Y-%m-%d')&lt; DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
        AND `roomId` IN
        <foreach item="roomId" collection="list" open="(" separator=","
                 close=")">
            #{roomId}
        </foreach>
    </select>
    <select id="selectRooms" resultType="com.gx.vo.OrderTimeVo">
    SELECT o.id AS orderId, o.`checkinNumber`,r.`roomAmount`,r.`roomAmount`-o.`checkinNumber` AS remainingBeds,
    r.`roomNumber`,s.`supplierName`,r.`id` AS roomId,s.id AS supplierId
    FROM `room` r LEFT JOIN `order` o ON o.`roomId`=r.id
    INNER JOIN `supplier` s ON s.id=r.`supplierID`
    WHERE s.`have`=1  AND o.`status`!=6 AND o.`status`!=3
  </select>

    <!-- 入住情况-->
    <select id="selectRoomByin" resultType="com.gx.vo.OrderTimeVo">
        SELECT r.*,r.id AS roomId,s.`supplierName`,s.id AS supplierId FROM room r INNER JOIN `supplier` s ON
        r.`supplierID`=s.id
        INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
        WHERE r.id NOT IN
        <foreach item="id" collection="idList" open="(" separator=","
                 close=")">
            #{id}
        </foreach>
        AND r.id IN
        <foreach item="rid" collection="allList" open="(" separator=","
                 close=")">
            #{rid}
        </foreach>
        AND g.`status`=1
    </select>
    <!-- 入住情况-->
    <select id="selectRoomByins" resultType="com.gx.vo.OrderTimeVo">
        SELECT r.*,r.id AS roomId,s.`supplierName`,s.id AS supplierId FROM room r INNER JOIN `supplier` s ON
        r.`supplierID`=s.id
        INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
        WHERE r.id IN
        <foreach item="rid" collection="allList" open="(" separator=","
                 close=")">
            #{rid}
        </foreach>
        AND g.`status`=1
    </select>

    <select id="countSelectRoomByTime" resultType="java.lang.Integer">
      SELECT COUNT(*)
	FROM `roomandtime` rt RIGHT JOIN `room` r ON rt.`roomId`=r.id
	INNER JOIN `supplier` s ON s.id=r.`supplierID`
	WHERE TO_DAYS(`intime`)=TO_DAYS(time)
	OR r.`id` NOT IN(
		SELECT `roomId` FROM `roomandtime` WHERE isout=1
	)
	AND s.`have`=1
	AND s.`isenabled`=0
  </select>

    <!--<update id="updateStatus">
        UPDATE `order` SET `status`=#{status,jdbcType=INTEGER} WHERE `orderNumber`=#{orderNumber,jdbcType=VARCHAR}
      </update>-->

    <update id="updateStatus">
      UPDATE `order` SET `status`=#{status,jdbcType=INTEGER}
       WHERE `id`=#{id,jdbcType=INTEGER}
    </update>

    <select id="selectByOrderNumber" resultType="com.gx.po.OrderPo">
        SELECT * from `order` where `orderNumber`=#{orderNumber,jdbcType=VARCHAR}
    </select>

    <select id="selectCheckinList" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.id AS orderID,o.`orderNumber` AS orderNumber,o.`status` AS `status`,o.`money` AS money,
        o.`checkinTime`AS checkintime,o.`checkoutTime` AS checkoutTime,o.`orderTime` AS orderTime,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE 1=1
        <if test="orderNumber!='' and orderNumber！=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passengerId!=null and passengerId!=''">
            AND `passengerId`= #{passengerId,jdbcType=INTEGER}
        </if>
        <if test="time!=0">
            AND `checkinTime`>=#{time,jdbcType=BIGINT}
        </if>
        AND `type`=1
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countSelectCheckinList" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE 1=1
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passengerId!=null and passengerId!=''">
            AND `passengerId`= #{passengerId,jdbcType=INTEGER}
        </if>
        <if test="time!=0">
            AND `checkinTime`>=#{time,jdbcType=BIGINT}
        </if>
        AND `type`=1
    </select>

    <select id="checkinDay" resultType="com.gx.vo.IndayVo">
  SELECT TIMESTAMPDIFF(DAY ,DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m-%d'),
  DATE_FORMAT(o.`checkoutTime`,'%Y-%m-%d')) AS count,`checkinNumber`AS `number`
  FROM `order`o WHERE `status`!=6 AND `status`!=3 AND `roomId`=#{roomId,jdbcType=INTEGER} AND o.`type`=1
</select>
    <select id="codeNumberYZ" resultType="java.lang.Integer">
    SELECT COUNT(*) FROM `order` WHERE `orderNumber`=#{orderNumber,jdbcType=VARCHAR}
  </select>

    <update id="updateMoney">
      UPDATE `order` SET `isdao`=2,`daoTime`=#{time,jdbcType=TIMESTAMP} WHERE `id`=#{id,jdbcType=INTEGER}
  </update>

    <update id="updateInEnd">
      UPDATE `order` SET `in`=#{start,jdbcType=VARCHAR},`out`=#{end,jdbcType=VARCHAR} WHERE id=#{id,jdbcType=INTEGER}
  </update>

    <select id="selectDayRoom" resultType="com.gx.vo.DayRoomNumberVo">
        SELECT r.id AS roomId,r.*,s.`supplierName`,o.`checkinTime`,o.`checkoutTime`,s.id AS supplierId,o.`checkinNumber`
        FROM `order` o INNER JOIN `room` r ON o.`roomId`=r.id INNER JOIN `supplier` s ON s.id=r.`supplierID`
        WHERE DATE_FORMAT( #{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') &gt;= DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
      AND DATE_FORMAT( #{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') &lt; DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
        AND `roomId`=#{roomId,jdbcType=INTEGER} AND o.status!=6 AND o.status!=3
  </select>

    <!--///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->

    <select id="allContractOrder" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE 1=1
        <if test="name!=null and name!=''">
            pa.name like CONCAT('%',#{name,jdbcType=VARCHAR},'%')
        </if>
        <if test="orderNumber!=null and orderNumber!=''">
            o.orderNumber like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        AND o.type=2
        AND s.`have`=2
        AND s.`isenabled`=0
        LIMIT #{start},#{size}
    </select>

    <select id="countallContractOrder" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE 1=1
        <if test="name!=null and name!=''">
            pa.name like CONCAT('%',#{name,jdbcType=VARCHAR},'%')
        </if>
        <if test="orderNumber!=null and orderNumber!=''">
            o.orderNumber like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        AND o.type=2
        AND s.`have`=2
        AND s.`isenabled`=0
    </select>

    <select id="fianceorder" resultType="com.gx.vo.OrderDetailsVo">
  SELECT o.*,
    p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
    a.`name` AS accountName,
    pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
    FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
    INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
    ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
    INNER JOIN `account` a ON a.`id`=o.`account`
    WHERE `roomId`=#{roomId,jdbcType=INTEGER}
     AND #{time,jdbcType=VARCHAR}=DATE_FORMAT(`orderTime`, '%Y-%m')
     AND o.status=6
    ORDER BY `orderTime`
</select>
    <select id="fianceordertime" resultType="com.gx.vo.OrderDetailsVo">
  SELECT o.*,
    p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
    a.`name` AS accountName,
    pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
    FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
    INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
    ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
    INNER JOIN `account` a ON a.`id`=o.`account`
    WHERE `roomId`=#{roomId,jdbcType=INTEGER}
    AND DATE_FORMAT(`orderTime`, '%Y-%m')=DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m')
    ORDER BY `orderTime`
</select>

    <select id="roomAcountu" resultType="java.lang.Integer">
     SELECT SUM(`checkinNumber`) FROM `order`
        WHERE `roomId`=#{roomId,jdbcType=INTEGER} AND `status`!=6 AND `status`!=3
  </select>
    <select id="selectById" resultType="com.gx.vo.OrderDetailsVo">
    SELECT o.*,
    p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
    a.`name` AS accountName,o.`passengerId` AS pId,o.`hotelmId` AS supplierId,
    pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber,pa.`genderName` AS genderID
    FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
    INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
    ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
    INNER JOIN `account` a ON a.`id`=o.`account`
    WHERE /* `type`=1*/
    /*AND*/ o.`id`=#{id,jdbcType=INTEGER}
  </select>
    <select id="updateCheckDay" resultType="com.gx.vo.IndayVo">
  SELECT TIMESTAMPDIFF(DAY ,DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m-%d'),
  DATE_FORMAT(o.`checkoutTime`,'%Y-%m-%d')) AS COUNT,`checkinNumber`AS `number`
  FROM `order` o WHERE `status`!=6 AND `status`!=3 AND `roomId`=#{roomId,jdbcType=INTEGER}
   AND o.`type`=1 AND o.id!=#{id,jdbcType=INTEGER}
</select>

    <update id="updateAll" parameterType="com.gx.po.OrderPo">
        UPDATE
        `order`
        SET
          `roomId` =#{roomId,jdbcType=INTEGER},
          `money` =#{money,jdbcType=DOUBLE},
          `currency` =#{currency,jdbcType=INTEGER},
          `checkinTime` =#{checkinTime,jdbcType=TIMESTAMP},
          `checkoutTime` =#{checkoutTime,jdbcType=TIMESTAMP},
          `orderTime` =#{orderTime,jdbcType=TIMESTAMP},
          `passengerId` =#{passengerId,jdbcType=INTEGER},
          `isdao` =#{isdao,jdbcType=INTEGER},
          `daoTime` =#{daoTime,jdbcType=TIMESTAMP},
          `checkinNumber` =#{checkinNumber,jdbcType=INTEGER},
          `checkinRoom` =#{checkinRoom,jdbcType=INTEGER},
          `account` =#{account,jdbcType=INTEGER},
          `checkinDay` =#{checkinDay,jdbcType=INTEGER},
          `type` = #{type,jdbcType=INTEGER},
          `in` = #{in,jdbcType=VARCHAR},
          `out` = #{out,jdbcType=VARCHAR}
        WHERE `id` =  #{id,jdbcType=INTEGER}
    </update>


    <!-- ==================================整租===================================================================== -->
    <select id="selectRoomByType" resultType="com.gx.vo.RoomVo">
        SELECT r.* ,g.`status` AS hometype,g.guestRoomLevel AS guestRoomLevelName,s.`supplierName`
        FROM `guestroomlevel` g INNER JOIN `room` r ON r.`guestRoomLevelID`=g.`id`
        INNER JOIN `supplier` s ON s.`id`=r.`supplierID`
        WHERE g.`id`=#{id,jdbcType=INTEGER}
        <if test="roomNumber!=null and roomNumber!=''">
            AND r.`roomNumber` like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY `time`
        LIMIT #{start},#{size}
    </select>

    <select id="countRoomByType" resultType="java.lang.Integer">
     SELECT COUNT(*)
   FROM `guestroomlevel` g INNER JOIN `room` r ON r.`guestRoomLevelID`=g.`id`
   INNER JOIN  `supplier` s ON s.`id`=r.`supplierID`
   WHERE g.`id`=#{id,jdbcType=INTEGER}
</select>
    <select id="countRoomByTypes" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `guestroomlevel` g INNER JOIN `room` r ON r.`guestRoomLevelID`=g.`id`
        INNER JOIN `supplier` s ON s.`id`=r.`supplierID`
        WHERE g.`id`=#{id,jdbcType=INTEGER}
        <if test="roomNumber!=null and roomNumber!=''">
            AND r.`roomNumber` like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <select id="selectDayRoomType" resultType="com.gx.vo.DayRoomNumberVo">
        SELECT r.id AS roomId,r.*,s.`supplierName`,o.`checkinTime`,o.`checkoutTime`,s.id AS supplierId,o.`checkinNumber`
        FROM `order` o INNER JOIN `room` r ON o.`roomId`=r.id INNER JOIN `supplier` s ON s.id=r.`supplierID`
        INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
        WHERE DATE_FORMAT( #{time,jdbcType=TIMESTAMP}, '%Y-%m-%d')  &gt;= DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
        AND DATE_FORMAT( #{time,jdbcType=TIMESTAMP}, '%Y-%m-%d')  &lt;  DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
      AND o.status!=6 AND o.`status`!=3 AND  g.`status`=2
        AND g.`id`=#{typeid,jdbcType=INTEGER}
    </select>
    <select id="selectEmptyRoom" resultType="com.gx.po.RoomSetPo">
          SELECT * FROM `room` r  INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
           WHERE (SELECT COUNT(1) AS num FROM `order` o WHERE o.`roomId` = r.`id`) = 0
           AND g.`status`=2
            AND g.`id`=#{typeid,jdbcType=INTEGER}
    </select>
    <select id="selectEmptyRoomByOrder" resultType="com.gx.po.RoomSetPo">
        SELECT * FROM `room` r  INNER JOIN `guestroomlevel` g ON g.`id`=r.`guestRoomLevelID`
        INNER JOIN `order` o ON o.`roomId`=r.`id`
        WHERE g.`status`=2  AND g.`id`=#{typeid,jdbcType=INTEGER}
    </select>

    <select id="YZDay" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` WHERE DATE_FORMAT( #{time,jdbcType=TIMESTAMP}, '%Y-%m-%d')  &gt;= DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
        AND DATE_FORMAT( #{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') &lt; DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
        AND`roomId`=#{roomId,jdbcType=INTEGER} AND `status`!=6 AND `status`!=3
    </select>

    <!--未确认-->
    <select id="listUnconfirmed" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=1
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countListUnconfirmed" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND */o.status=1
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
    </select>

    <!--已取消-->
    <select id="listCancelled" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName,
        pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=3
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countListCancelled" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `passenger` pa
        ON o.`passengerId`=pa.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        WHERE /*`type`=1 AND */o.status=3
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="passenger!='' and passenger!=null">
            AND pa.`name` like CONCAT('%',#{passenger,jdbcType=VARCHAR},'%')
        </if>
    </select>

    <!--==============================================================改==================================================================-->

    <!--已确认-->
    <select id="allConfirm" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,gu.`guestRoomLevel` AS guestRoomLevel,r.`referencePrice` AS referencePrice,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName, pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if><!--
        <if test="passName!='' and passName!=null">
            AND o.`orderNumber` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=2
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countAllConfirm" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if><!--
        <if test="passName!='' and passName!=null">
            AND o.`orderNumber` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=2
    </select>
    <!--已入住-->
    <select id="checkinallorder" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,gu.`guestRoomLevel` AS guestRoomLevel,pas.name AS reserationName,pas.phoneNumber AS
        mobile,r.`referencePrice` AS referencePrice,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName, pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `passenger` pas ON o.`inpasssId`=pas.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if>
        <if test="passName!='' and passName!=null">
            AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=5
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countcheckinallorder" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `passenger` pas ON o.`inpasssId`=pas.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        WHERE /*`type`=1 AND*/ o.status=5
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if>
        <if test="passName!='' and passName!=null">
            AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!--已退房-->
    <select id="checkoutallorder" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,gu.`guestRoomLevel` AS guestRoomLevel,pas.name AS reserationName,pas.phoneNumber AS
        mobile,r.`referencePrice` AS referencePrice,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName, pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `passenger` pas ON o.`inpasssId`=pas.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE /*`type`=1 AND*/ o.status=6
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if>
        <if test="passName!='' and passName!=null">
            AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY `checkinTime` DESC
        LIMIT #{start},#{size}
    </select>

    <select id="countcheckoutallorder" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `passenger` pas ON o.`inpasssId`=pas.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        WHERE /*`type`=1 AND*/ o.status=6
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if>
        <if test="passName!='' and passName!=null">
            AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!--已到账-->
    <select id="myaccountall" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,gu.`guestRoomLevel` AS guestRoomLevel,r.`referencePrice` AS referencePrice,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName, pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE /*`type`=1 AND*/ o.isdao=2
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if>
        <!-- <if test="passName!='' and passName!=null">
             AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
         </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY `checkinTime` DESC
        LIMIT #{start},#{size}
    </select>

    <select id="countmyaccountall" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        WHERE /*`type`=1 AND*/ o.isdao=2
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if>
        <!-- <if test="passName!='' and passName!=null">
             AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
         </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
    </select>
    <!--未确认-->
    <select id="listUnconfirmedall" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,gu.`guestRoomLevel` AS guestRoomLevel,r.`referencePrice` AS referencePrice,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName, pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if><!--
        <if test="passName!='' and passName!=null">
            AND o.`orderNumber` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=1
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countListUnconfirmedall" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        WHERE /*`type`=1 AND */o.status=1
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if><!--
        <if test="passName!='' and passName!=null">
            AND o.`orderNumber` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
    </select>

    <!--已取消-->
    <select id="listCancelledall" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,gu.`guestRoomLevel` AS guestRoomLevel,r.`referencePrice` AS referencePrice,
        p.`name` AS platformName,s.`supplierName`AS supplierName,r.`roomNumber` AS roomNumber,
        a.`name` AS accountName, pa.`name`AS `name` ,pa.`phoneNumber` AS phoneNumber
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        /*WHERE `type`=1*/
        WHERE 1=1
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if><!--
        <if test="passName!='' and passName!=null">
            AND o.`orderNumber` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        /* AND `type`=1*/ AND o.status=3
        ORDER BY `checkinTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countListCancelledall" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `platform` p ON o.`platformId`=p.`id`
        INNER JOIN `supplier` s ON o.`hotelmId`=s.`id` INNER JOIN `room` r ON r.`id`=o.`roomId`
        INNER JOIN `account` a ON a.`id`=o.`account`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `guestroomlevel` gu ON gu.id=o.`hometype`
        WHERE /*`type`=1 AND */o.status=3
        <if test="platform!='' and platform!=null">
            AND p.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="order!='' and order!=null">
            AND o.`orderNumber` like CONCAT('%',#{order,jdbcType=VARCHAR},'%')
        </if><!--
        <if test="passName!='' and passName!=null">
            AND o.`orderNumber` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>-->
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
    </select>

    <update id="updateRegister">
        UPDATE `order` SET `inpasssId`=#{inpasssId,jdbcType=INTEGER} WHERE `id`=#{id,jdbcType=INTEGER}
    </update>

    <select id="selectFinanceTwo" resultType="com.gx.vo.OrderDetailsVo">
        SELECT o.*,p.`name` AS reserationName,p.`phoneNumber` AS mobile,r.`roomNumber` ,pl.`name`AS platformName
        ,r.`referencePrice` AS referencePrice,g.`guestRoomLevel` AS guestRoomLevel
        FROM `order` o INNER JOIN `passenger` p ON o.`inpasssId`=p.id
        INNER JOIN `room` r ON o.`roomId`=r.id
        INNER JOIN `platform` pl ON pl.id=o.`platformId`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `passenger` pas ON o.`inpasssId`=pas.`id`
        INNER JOIN `guestroomlevel` g ON g.id=o.`hometype`
        WHERE o.`status`=6
        <if test="platform!='' and platform!=null">
            AND pl.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="roomName!='' and roomName!=null">
            AND r.`roomNumber` like CONCAT('%',#{roomName,jdbcType=VARCHAR},'%')
        </if>
        <if test="time!=null">
            AND DATE_FORMAT(#{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') = DATE_FORMAT(o.`orderTime`, '%Y-%m-%d')
        </if>
        <if test="passName!='' and passName!=null">
            AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
        </if>
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
        ORDER BY o.`orderTime`
        LIMIT #{start},#{size}
    </select>

    <select id="countFinanceTwo" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `order` o INNER JOIN `passenger` p ON o.`inpasssId`=p.id
        INNER JOIN `room` r ON o.`roomId`=r.id
        INNER JOIN `platform` pl ON pl.id=o.`platformId`
        INNER JOIN `passenger` pa ON o.`passengerId`=pa.`id`
        INNER JOIN `passenger` pas ON o.`inpasssId`=pas.`id`
        WHERE o.`status`=6
        <if test="platform!='' and platform!=null">
            AND pl.`id` =#{platform,jdbcType=INTEGER}
        </if>
        <if test="orderNumber!='' and orderNumber!=null">
            AND o.`orderNumber` like CONCAT('%',#{orderNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="roomName!='' and roomName!=null">
            AND r.`roomNumber` like CONCAT('%',#{roomName,jdbcType=VARCHAR},'%')
        </if>
        <if test="time!=null">
            AND DATE_FORMAT(#{time,jdbcType=TIMESTAMP}, '%Y-%m-%d') = DATE_FORMAT(o.`orderTime`, '%Y-%m-%d')
        </if>
        <if test="passName!='' and passName!=null">
        AND pas.`name` like CONCAT('%',#{passName,jdbcType=VARCHAR},'%')
    </if>
        <if test="reserName!='' and reserName!=null">
            AND pa.`name` like CONCAT('%',#{reserName,jdbcType=VARCHAR},'%')
        </if>
    </select>

    <select id="selectWhole" resultType="java.lang.Integer">
    SELECT COUNT(*) FROM `order` o
    WHERE DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m-%d')>=  DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
    AND DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m-%d') &lt;DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
    AND `roomId`=#{roomId,jdbcType=INTEGER} AND `status`!=6 AND `status`!=3 and id!=#{id,jdbcType=INTEGER}
</select>



    <select id="orderByplatform" resultType="com.gx.vo.OrderDetailsVo">
         SELECT o.* ,pl.`name`AS platformName,r.`roomNumber`,r.`referencePrice` AS referencePrice,g.`guestRoomLevel` AS guestRoomLevel
        FROM `order` o  INNER JOIN `platform` pl ON pl.id=o.`platformId`
          INNER JOIN `room` r ON o.`roomId`=r.id
          INNER JOIN `guestroomlevel` g ON g.id=o.`hometype`
        WHERE `platformId`=#{platformId,jdbcType=INTEGER}
         ORDER BY o.`orderTime`
        LIMIT #{start},#{size}
    </select>
    <select id="countOrderByplatform" resultType="java.lang.Integer">
         SELECT COUNT(*) FROM `order` o
         INNER JOIN `platform` pl ON pl.id=o.`platformId`
           INNER JOIN `room` r ON o.`roomId`=r.id
             INNER JOIN `guestroomlevel` g ON g.id=o.`hometype`
         WHERE `platformId`=#{platformId,jdbcType=INTEGER}
    </select>


    <select id="WholeEmtyRoom" resultType="java.lang.Integer">
       SELECT COUNT(*)
         FROM `order` o INNER JOIN `guestroomlevel` g
         ON o.`hometype`=g.id
        WHERE DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m-%d')  >= DATE_FORMAT(`checkinTime`, '%Y-%m-%d')
        AND DATE_FORMAT(#{time,jdbcType=VARCHAR}, '%Y-%m-%d') &lt; DATE_FORMAT(`checkoutTime`, '%Y-%m-%d')
        AND o.`roomId`=#{roomId,jdbcType=INTEGER} AND o.`status`!=6 AND o.`status`!=3
    </select>
    <select id="WholeEmtyRoomDeatil" resultType="com.gx.vo.OrderTimeVo">
         SELECT *,s.id AS supplierId
         FROM `room` r INNER JOIN  `guestroomlevel` g
        ON  r.`guestRoomLevelID`=g.id
        INNER JOIN `supplier` s ON s.id=r.`supplierID`
        WHERE r.id=#{roomId,jdbcType=INTEGER}
    </select>

    <update id="updateDeposit">
       UPDATE `order` SET `depositSattus` =#{depositSattus,jdbcType=INTEGER} WHERE `id`=#{roomId,jdbcType=INTEGER}
    </update>



    <!--根据供应商查询-->
    <select id="orderBySupplier" resultType="com.gx.vo.OrderDetailsVo">
         SELECT o.* ,pl.`name`AS platformName,r.`roomNumber`,r.`referencePrice` AS referencePrice,g.`guestRoomLevel` AS guestRoomLevel
 ,s.`id` AS supplierId,s.`supplierName` AS supplierName
        FROM `order` o  INNER JOIN `platform` pl ON pl.id=o.`platformId`
          INNER JOIN `room` r ON o.`roomId`=r.id
          INNER JOIN `guestroomlevel` g ON g.id=o.`hometype`
          INNER JOIN `supplier` s ON s.`id`=r.`supplierID`
        WHERE r.`supplierID`=#{supplierID,jdbcType=INTEGER}
         ORDER BY o.`orderTime`
        LIMIT #{start},#{size}
    </select>
    <select id="countOrderBySupplier" resultType="java.lang.Integer">
         SELECT COUNT(*)
         FROM `order` o  INNER JOIN `platform` pl ON pl.id=o.`platformId`
          INNER JOIN `room` r ON o.`roomId`=r.id
          INNER JOIN `guestroomlevel` g ON g.id=o.`hometype`
          INNER JOIN `supplier` s ON s.`id`=r.`supplierID`
        WHERE r.`supplierID`=#{supplierID,jdbcType=INTEGER}
         ORDER BY o.`orderTime`
    </select>
</mapper>